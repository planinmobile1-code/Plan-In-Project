<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Project Countdown Dashboard</title>
<style>
body {
 font-family: Arial, sans-serif;
 padding: 20px;
 background: #f3f4f6;
}
.project {
 background: white;
 padding: 20px;
 margin: 20px auto;
 max-width: 900px;
 border-radius: 10px;
 box-shadow: 0 4px 12px rgba(0,0,0,0.1);
 display: flex;
 gap: 20px;
}
.project-info {
 flex: 1;
}
.countdown {
 margin-top: 10px;
 font-size: 20px;
 font-weight: bold;
}
.calendar {
 flex: 1;
 display: grid;
 grid-template-columns: repeat(4, 1fr);
 gap: 5px;
 font-size: 14px;
}
.month {
 padding: 8px;
 text-align: center;
 border-radius: 4px;
 background: #eee;
}
.month.highlight {
 background: #ffcc80;
 font-weight: bold;
}
</style>
</head>
<body>
<h1 style="text-align:center;">ðŸ“… Project Countdown Dashboard</h1>
<div id="container"></div>
<script>
const jsonURL = "https://docs.google.com/spreadsheets/d/1_jNi6ukRJRNwNrzikG-gIZnPSjGHPpDs_ckDSy9pBNA/gviz/tq?tqx=out:json&gid=0";
async function loadProjects() {
 try {
   const res = await fetch(jsonURL);
   let text = await res.text();
   const json = JSON.parse(text.substring(47, text.length - 2)); // gviz JSON è£åˆ‡
   const rows = json.table.rows;
   const projects = rows
     .filter(r => r.c && r.c[0]?.v)
     .map(r => ({
       name: r.c[0]?.v || "",
       team: r.c[1]?.v || "",
       deadline: r.c[3]?.v || "", // plain text
       manager: r.c[4]?.v || "",
       sec: r.c[5]?.v || "",
       possession: r.c[6]?.v || "",
       completion: r.c[7]?.v || ""
     }));
   renderProjects(projects);
 } catch(e) {
   console.error("JSON load error:", e);
 }
}
function renderProjects(projects) {
 const container = document.getElementById("container");
 container.innerHTML = "";
 // PD æŽ’åº
 const order = ["PD1", "PD2", "PD3"];
 projects.sort((a,b)=>{
   let aTeam = a.team.split(":")[0];
   let bTeam = b.team.split(":")[0];
   return order.indexOf(aTeam) - order.indexOf(bTeam);
 });
 projects.forEach((p,i)=>{
   const projDiv = document.createElement("div");
   projDiv.className = "project";
   // Info + Countdown
   const infoDiv = document.createElement("div");
   infoDiv.className = "project-info";
   infoDiv.innerHTML = `
<h2>${p.name}</h2>
<p><b>Team:</b> ${p.team}</p>
<p><b>Project Manager:</b> ${p.manager}</p>
<p><b>Project Secretary:</b> ${p.sec}</p>
<p><b>Tentative Possession:</b> ${p.possession}</p>
<p><b>Tentative Completion:</b> ${p.completion}</p>
<div class="countdown" id="cd${i}"></div>
   `;
   projDiv.appendChild(infoDiv);
   // Calendar
   const calendarDiv = document.createElement("div");
   calendarDiv.className = "calendar";
   const now = new Date();
   const possessionMonth = p.possession ? new Date(p.possession) : null;
   const completionMonth = p.completion ? new Date(p.completion) : null;
   for(let m=0;m<12;m++){
     const monthDate = new Date(now.getFullYear(), now.getMonth()+m,1);
     const monthDiv = document.createElement("div");
     monthDiv.className = "month";
     monthDiv.textContent = monthDate.toLocaleString('default',{month:'short',year:'2-digit'});
     if(possessionMonth && completionMonth){
       if(monthDate >= new Date(possessionMonth.getFullYear(),possessionMonth.getMonth(),1) &&
          monthDate <= new Date(completionMonth.getFullYear(),completionMonth.getMonth(),1)){
         monthDiv.classList.add("highlight");
       }
     }
     calendarDiv.appendChild(monthDiv);
   }
   projDiv.appendChild(calendarDiv);
   container.appendChild(projDiv);
   // Start countdown AFTER element in DOM
   startCountdown(p.deadline,"cd"+i);
 });
}
// Countdown function
function startCountdown(dltxt,id){
 const target = new Date(dltxt.replace(" ","T"));
 function tick(){
   const el = document.getElementById(id);
   if(!el) return;
   const now = new Date();
   const diff = target - now;
   if(diff<=0){
     el.textContent = "ðŸŽ‰ Completed!";
     return;
   }
   const d = Math.floor(diff / (1000*60*60*24));
   const h = Math.floor((diff / (1000*60*60))%24);
   const m = Math.floor((diff / (1000*60))%60);
   const s = Math.floor((diff/1000)%60);
   el.textContent = `${d} Days ${h} Hours ${m} Minutes ${s} Seconds`;
 }
 tick();
 setInterval(tick,1000);
}
loadProjects();
</script>
</body>
</html>