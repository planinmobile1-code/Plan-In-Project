<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Project Countdown Dashboard</title>
<style>
body {
   font-family: Arial, sans-serif;
   padding: 20px;
   background: #f3f4f6;
}
.team-group {
   margin-top: 40px;
}
.team-title {
   font-size: 26px;
   font-weight: bold;
   margin-bottom: 10px;
}
.project {
   background: white;
   padding: 20px;
   margin: 15px auto;
   max-width: 800px;
   border-radius: 10px;
   box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
.countdown {
   margin-top: 10px;
   font-size: 22px;
   font-weight: bold;
}
</style>
</head>
<body>
<h1 style="text-align:center;">ðŸ“… Project Countdown Dashboard</h1>
<div id="container"></div>
<script>
const jsonURL =
"https://docs.google.com/spreadsheets/d/1_jNi6ukRJRNwNrzikG-gIZnPSjGHPpDs_ckDSy9pBNA/gviz/tq?tqx=out:json";
/* Team â†’ Director Map */
const TEAM_DIRECTOR = {
   "PD1": "Wai Leung",
   "PD2": "Harley Lau",
   "PD3": "Sherman Choi"
};
/* -------------------------------
  Load Google Sheet JSON
-------------------------------- */
async function loadProjects() {
   try {
       const res = await fetch(jsonURL);
       let text = await res.text();
       const start = text.indexOf("{");
       const end = text.lastIndexOf("}") + 1;
       const cleanText = text.substring(start, end);
       const json = JSON.parse(cleanText);
       const rows = json.table.rows;
       // Column Mapping:
       // A = Project Name
       // B = Team
       // C = Deadline
       // D = DeadlineText
       // E = Project Manager
       // F = Project Secretary
       const projects = rows.map(r => ({
           name: r.c[0]?.v || "",
           team: r.c[1]?.v || "",
           deadlineText: r.c[3]?.v || "",
           manager: r.c[4]?.v || "",
           sec: r.c[5]?.v || ""
       }));
       renderGrouped(projects);
   } catch (err) {
       console.error("JSON load error:", err);
   }
}
/* -------------------------------
  Group By Team
-------------------------------- */
function renderGrouped(list) {
   const container = document.getElementById("container");
   container.innerHTML = "";
   // Grouping
   const groups = {};
   list.forEach(p => {
       if (!p.team) return;
       if (!groups[p.team]) groups[p.team] = [];
       groups[p.team].push(p);
   });
   // Render each team
   Object.keys(groups).forEach(team => {
       const groupDiv = document.createElement("div");
       groupDiv.className = "team-group";
       const director = TEAM_DIRECTOR[team] || "";
       groupDiv.innerHTML = `
<div class="team-title">${team} â€“ ${director}</div>
       `;
       groups[team].forEach((p, i) => {
           const card = document.createElement("div");
           card.className = "project";
           card.innerHTML = `
<h2>${p.name}</h2>
<p><b>Project Manager:</b> ${p.manager}</p>
<p><b>Project Secretary:</b> ${p.sec}</p>
<div class="countdown" id="${team}_cd${i}"></div>
           `;
           groupDiv.appendChild(card);
           createCountdown(p.deadlineText, `${team}_cd${i}`);
       });
       container.appendChild(groupDiv);
   });
}
/* -------------------------------
  Countdown
-------------------------------- */
function createCountdown(dltxt, id) {
   const target = new Date(dltxt.replace(" ", "T"));
   function tick() {
       const el = document.getElementById(id);
       if (!el) return;
       const now = new Date();
       const diff = target - now;
       if (diff <= 0) {
           el.textContent = "ðŸŽ‰ Completed!";
           return;
       }
       const d = Math.floor(diff / (1000 * 60 * 60 * 24));
       const h = Math.floor((diff / (1000 * 60 * 60)) % 24);
       const m = Math.floor((diff / (1000 * 60)) % 60);
       const s = Math.floor((diff / 1000) % 60);
       el.textContent = `${d} Days ${h} Hours ${m} Minutes ${s} Seconds`;
   }
   tick();
   setInterval(tick, 1000);
}
loadProjects();
</script>
</body>
</html>