<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<title>Project Countdown Dashboard</title>
<style>
body {
 font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
 padding: 40px 20px;
 background: #eef2f7;
 color: #333;
}
h1 {
 text-align: center;
 margin-bottom: 40px;
 font-size: 2em;
 color: #222;
}
h2 {
 margin-top: 40px;
 margin-bottom: 10px;
 color: #1976d2;
 border-bottom: 2px solid #1976d2;
 padding-bottom: 4px;
}
.team-container {
 display: flex;
 flex-direction: column;
 gap: 10px;
}
.project-info {
 background: white;
 padding: 10px 15px;
 border-radius: 8px;
 box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
.project-info h3 {
 margin: 0 0 6px 0;
 font-size: 1.2em;
 color: #333;
}
.project-info p {
 margin: 2px 0;
 color: #555;
 font-size: 0.9em;
}
.countdown {
 font-size: 16px;
 font-weight: bold;
 color: #d32f2f;
 margin-top: 4px;
}
.month-bar {
 position: relative;
 width: 100%;
 height: 30px;
 background: #eee;
 border-radius: 6px;
 margin-top: 6px;
}
.month-labels {
 display: flex;
 justify-content: space-between;
 font-size: 0.8em;
 color: #555;
 margin-bottom: 4px;
}
.project-bar {
 position: absolute;
 height: 20px;
 border-radius: 6px;
 background-color: #4caf50;
 opacity: 0.8;
 top: 5px;
}
</style>
</head>
<body>
<h1>ðŸ“… Project Countdown Dashboard</h1>
<h2>PD1: Wai Leung</h2>
<div class="team-container" id="team-PD1"></div>
<div class="month-labels" id="labels-PD1"></div>
<div class="month-bar" id="bar-PD1"></div>
<h2>PD2: Harley Lau</h2>
<div class="team-container" id="team-PD2"></div>
<div class="month-labels" id="labels-PD2"></div>
<div class="month-bar" id="bar-PD2"></div>
<h2>PD3: Sherman Choi</h2>
<div class="team-container" id="team-PD3"></div>
<div class="month-labels" id="labels-PD3"></div>
<div class="month-bar" id="bar-PD3"></div>
<script>
const jsonURL = "https://docs.google.com/spreadsheets/d/1_jNi6ukRJRNwNrzikG-gIZnPSjGHPpDs_ckDSy9pBNA/gviz/tq?tqx=out:json&gid=0";
const teamOrder = ["PD1","PD2","PD3"];
const teamColors = {PD1:"#4caf50",PD2:"#f57c00",PD3:"#1976d2"};
async function loadProjects() {
 try {
   const res = await fetch(jsonURL);
   const text = await res.text();
   const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\);/s);
   if(!jsonMatch) throw new Error("ç„¡æ³•è§£æž Google Sheets JSON");
   const json = JSON.parse(jsonMatch[1]);
   const rows = json.table.rows;
   const projects = rows.slice(1).filter(r=>r.c && r.c[0]?.v).map(r=>({
     name: r.c[0]?.v || "",
     team: r.c[1]?.v || "",
     manager: r.c[2]?.v || "",
     secretary: r.c[3]?.v || "",
     possession: r.c[4]?.v || "",
     completion: r.c[5]?.v || "",
     deadlineText: r.c[6]?.v || ""
   }));
   projects.sort((a,b)=>{
     const aTeam = a.team.split(":")[0].trim();
     const bTeam = b.team.split(":")[0].trim();
     return teamOrder.indexOf(aTeam) - teamOrder.indexOf(bTeam);
   });
   renderProjects(projects);
 } catch(err){
   console.error("JSON load error:", err);
 }
}
function renderProjects(projects){
 const now = new Date();
 const months = Array.from({length:12},(_,i)=>new Date(now.getFullYear(),now.getMonth()+i,1));
 const monthNames = months.map(m => m.toLocaleString('en', {month:'short'}));
 // åˆå§‹åŒ–æ¯å€‹ Team çš„æœˆä»½æ–‡å­—
 teamOrder.forEach(team=>{
   const labelEl = document.getElementById(`labels-${team}`);
   labelEl.innerHTML = monthNames.map(m=>`<div>${m}</div>`).join("");
 });
 projects.forEach((p,i)=>{
   const teamKey = p.team.split(":")[0].trim();
   const container = document.getElementById(`team-${teamKey}`);
   const barContainer = document.getElementById(`bar-${teamKey}`);
   if(!container || !barContainer) return;
   const div = document.createElement("div");
   div.className="project-info";
   div.innerHTML=`
<h3>${p.name}</h3>
<p><b>Project Manager:</b> ${p.manager}</p>
<p><b>Project Secretary:</b> ${p.secretary}</p>
<p><b>Deadline:</b> ${p.deadlineText}</p>
<p class="countdown" id="cd${i}"></p>
<p><b>Tentative Possession:</b> ${p.possession}</p>
<p><b>Tentative Completion:</b> ${p.completion}</p>
   `;
   container.appendChild(div);
   createCountdown(p.deadlineText,`cd${i}`);
   createProjectBar(p.possession,p.completion,barContainer,teamColors[teamKey]);
 });
}
function createCountdown(dltxt,id){
 const target=new Date(dltxt.replace(" ","T"));
 function tick(){
   const el=document.getElementById(id);
   const now=new Date();
   const diff=target-now;
   if(diff<=0){el.textContent="ðŸŽ‰ Completed!";return;}
   const d=Math.floor(diff/(1000*60*60*24));
   const h=Math.floor((diff/(1000*60*60))%24);
   const m=Math.floor((diff/(1000*60))%60);
   const s=Math.floor((diff/1000)%60);
   el.textContent=`${d} Days ${h} Hours ${m} Minutes ${s} Seconds`;
 }
 tick();
 setInterval(tick,1000);
}
function createProjectBar(posTxt, compTxt,barContainer,color){
 if(!posTxt || !compTxt) return;
 const now = new Date();
 const months = Array.from({length:12},(_,i)=>new Date(now.getFullYear(),now.getMonth()+i,1));
 const possession = new Date(posTxt.replace(" ","T"));
 const completion = new Date(compTxt.replace(" ","T"));
 let startIndex = 0, endIndex = 11;
 for(let i=0;i<12;i++){
   if(months[i]<=possession) startIndex=i;
   if(months[i+1]>completion) {endIndex=i; break;}
 }
 const totalMonths=12;
 const leftPercent = (startIndex/totalMonths)*100;
 const widthPercent = ((endIndex-startIndex+1)/totalMonths)*100;
 const bar = document.createElement("div");
 bar.className="project-bar";
 bar.style.left = leftPercent+"%";
 bar.style.width = widthPercent+"%";
 bar.style.backgroundColor = color;
 barContainer.appendChild(bar);
}
loadProjects();
</script>
</body>
</html>