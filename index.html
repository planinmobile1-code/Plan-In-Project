<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<title>Project Countdown Dashboard</title>
<style>
body {
 font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
 padding: 40px 20px;
 background: #eef2f7;
 color: #333;
}
h1 {
 text-align: center;
 margin-bottom: 40px;
 font-size: 2em;
 color: #222;
}
h2 {
 margin-top: 40px;
 margin-bottom: 20px;
 color: #1976d2;
 border-bottom: 2px solid #1976d2;
 padding-bottom: 4px;
}
.team-container {
 display: flex;
 flex-direction: column;
 gap: 20px;
}
.project {
 display: flex;
 flex-direction: column;
 background: white;
 padding: 20px 30px;
 border-radius: 12px;
 box-shadow: 0 6px 18px rgba(0,0,0,0.12);
 gap: 10px;
}
.project-info h3 {
 margin-bottom: 10px;
 font-size: 1.3em;
 color: #333;
}
.project-info p {
 margin: 4px 0;
 color: #555;
}
.countdown {
 font-size: 20px;
 font-weight: bold;
 color: #d32f2f;
}
.progress-container {
 width: 100%;
 height: 20px;
 background: #eee;
 border-radius: 10px;
 position: relative;
 margin-top: 8px;
}
.progress-bar {
 height: 100%;
 background: #4caf50;
 border-radius: 10px;
 width: 0%;
 position: absolute;
 transition: width 0.5s, left 0.5s;
}
.progress-months {
 display: flex;
 justify-content: space-between;
 font-size: 0.8em;
 margin-top: 4px;
 color: #555;
}
.progress-month {
 flex: 1;
 text-align: center;
}
</style>
</head>
<body>
<h1>ðŸ“… Project Countdown Dashboard</h1>
<div id="container">
<h2>PD1: Wai Leung</h2>
<div class="team-container" id="team-PD1"></div>
<h2>PD2: Harley Lau</h2>
<div class="team-container" id="team-PD2"></div>
<h2>PD3: Sherman Choi</h2>
<div class="team-container" id="team-PD3"></div>
</div>
<script>
const jsonURL = "https://docs.google.com/spreadsheets/d/1_jNi6ukRJRNwNrzikG-gIZnPSjGHPpDs_ckDSy9pBNA/gviz/tq?tqx=out:json&gid=0";
const teamOrder = ["PD1","PD2","PD3"];
async function loadProjects() {
 try {
   const res = await fetch(jsonURL);
   const text = await res.text();
   const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\);/s);
   if(!jsonMatch) throw new Error("ç„¡æ³•è§£æž Google Sheets JSON");
   const json = JSON.parse(jsonMatch[1]);
   const rows = json.table.rows;
   const projects = rows.slice(1).filter(r=>r.c && r.c[0]?.v).map(r=>({
     name: r.c[0]?.v || "",
     team: r.c[1]?.v || "",
     manager: r.c[2]?.v || "",
     secretary: r.c[3]?.v || "",
     possession: r.c[4]?.v || "",
     completion: r.c[5]?.v || "",
     deadlineText: r.c[6]?.v || ""
   }));
   projects.sort((a,b)=>{
     const aTeam = a.team.split(":")[0].trim();
     const bTeam = b.team.split(":")[0].trim();
     return teamOrder.indexOf(aTeam) - teamOrder.indexOf(bTeam);
   });
   renderProjects(projects);
 } catch(err){
   console.error("JSON load error:", err);
 }
}
function renderProjects(projects){
 projects.forEach((p,i)=>{
   const teamKey = p.team.split(":")[0].trim();
   const container = document.getElementById(`team-${teamKey}`);
   if(!container) return;
   const div = document.createElement("div");
   div.className="project";
   div.innerHTML=`
<div class="project-info">
<h3>${p.name}</h3>
<p><b>Project Manager:</b> ${p.manager}</p>
<p><b>Project Secretary:</b> ${p.secretary}</p>
<p><b>Deadline:</b> ${p.deadlineText}</p>
<p class="countdown" id="cd${i}"></p>
<p><b>Tentative Possession:</b> ${p.possession}</p>
<p><b>Tentative Completion:</b> ${p.completion}</p>
<div class="progress-container" id="progress${i}"><div class="progress-bar"></div></div>
<div class="progress-months">
<div class="progress-month">Jan</div>
<div class="progress-month">Feb</div>
<div class="progress-month">Mar</div>
<div class="progress-month">Apr</div>
<div class="progress-month">May</div>
<div class="progress-month">Jun</div>
<div class="progress-month">Jul</div>
<div class="progress-month">Aug</div>
<div class="progress-month">Sep</div>
<div class="progress-month">Oct</div>
<div class="progress-month">Nov</div>
<div class="progress-month">Dec</div>
</div>
</div>
   `;
   container.appendChild(div);
   createCountdown(p.deadlineText,`cd${i}`);
   createProgress(p.possession,p.completion,`progress${i}`);
 });
}
function createCountdown(dltxt,id){
 const target=new Date(dltxt.replace(" ","T"));
 function tick(){
   const el=document.getElementById(id);
   const now=new Date();
   const diff=target-now;
   if(diff<=0){el.textContent="ðŸŽ‰ Completed!";return;}
   const d=Math.floor(diff/(1000*60*60*24));
   const h=Math.floor((diff/(1000*60*60))%24);
   const m=Math.floor((diff/(1000*60))%60);
   const s=Math.floor((diff/1000)%60);
   el.textContent=`${d} Days ${h} Hours ${m} Minutes ${s} Seconds`;
 }
 tick();
 setInterval(tick,1000);
}
function createProgress(posTxt,compTxt,id){
 if(!posTxt||!compTxt)return;
 const container=document.getElementById(id);
 const bar=container.querySelector(".progress-bar");
 const now=new Date();
 const months=Array.from({length:12},(_,i)=>new Date(now.getFullYear(),i,1));
 const possession=new Date(posTxt.replace(" ","T"));
 const completion=new Date(compTxt.replace(" ","T"));
 const totalMonths=months.length;
 let startIndex=0,endIndex=11;
 for(let i=0;i<12;i++){
   if(months[i]<=possession) startIndex=i;
   if(months[i+1]>completion) {endIndex=i; break;}
 }
 const widthPercent=((endIndex-startIndex+1)/totalMonths)*100;
 bar.style.width=`${widthPercent}%`;
 bar.style.left=`${(startIndex/totalMonths)*100}%`;
}
loadProjects();
</script>
</body>
</html>