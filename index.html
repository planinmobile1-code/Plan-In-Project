<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<title>Project Countdown Dashboard</title>
<style>
body {
 font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
 padding: 40px 20px;
 background: #eef2f7;
 color: #333;
}
h1 {
 text-align: center;
 margin-bottom: 40px;
 font-size: 2em;
 color: #222;
}
h2 {
 margin-top: 40px;
 margin-bottom: 20px;
 color: #1976d2;
 border-bottom: 2px solid #1976d2;
 padding-bottom: 4px;
}
.team-container {
 display: flex;
 flex-direction: column;
 gap: 20px;
}
.project {
 display: flex;
 justify-content: space-between;
 align-items: flex-start;
 background: white;
 padding: 20px 30px;
 border-radius: 12px;
 box-shadow: 0 6px 18px rgba(0,0,0,0.12);
 gap: 20px;
}
.project-info {
 flex: 1;
 line-height: 1.6;
}
.project-info h3 {
 margin-bottom: 10px;
 font-size: 1.3em;
 color: #333;
}
.project-info p {
 margin: 4px 0;
 color: #555;
}
.countdown {
 margin-top: 10px;
 font-size: 20px;
 font-weight: bold;
 color: #d32f2f;
}
.calendar {
 margin-left: 20px;
 display: flex;
 flex-wrap: wrap;
 justify-content: flex-start;
 max-width: 280px;
}
.month {
 flex: 0 0 auto;
 margin: 4px;
 padding: 6px 8px;
 font-size: 0.85em;
 background: #f0f0f0;
 border-radius: 6px;
 text-align: center;
 transition: background 0.3s;
}
.month.highlight {
 background: #4caf50;
 color: white;
}
</style>
</head>
<body>
<h1>ðŸ“… Project Countdown Dashboard</h1>
<div id="container">
<h2>PD1: Wai Leung</h2>
<div class="team-container" id="team-PD1"></div>
<h2>PD2: Harley Lau</h2>
<div class="team-container" id="team-PD2"></div>
<h2>PD3: Sherman Choi</h2>
<div class="team-container" id="team-PD3"></div>
</div>
<script>
const jsonURL = "https://docs.google.com/spreadsheets/d/1_jNi6ukRJRNwNrzikG-gIZnPSjGHPpDs_ckDSy9pBNA/gviz/tq?tqx=out:json&gid=0";
// Team æŽ’åº
const teamOrder = ["PD1", "PD2", "PD3"];
async function loadProjects() {
 try {
   const res = await fetch(jsonURL);
   const text = await res.text();
   // è§£æž Google Visualization JSON
   const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\);/s);
   if (!jsonMatch) throw new Error("ç„¡æ³•è§£æž Google Sheets JSON");
   const json = JSON.parse(jsonMatch[1]);
   const rows = json.table.rows;
   const projects = rows
     .slice(1)
     .filter(r => r.c && r.c[0]?.v)
     .map(r => ({
       name: r.c[0]?.v || "",
       team: r.c[1]?.v || "",
       manager: r.c[2]?.v || "",
       secretary: r.c[3]?.v || "",
       possession: r.c[4]?.v || "",
       completion: r.c[5]?.v || "",
       deadlineText: r.c[6]?.v || ""
     }));
   // æŒ‰ teamOrder æŽ’åº
   projects.sort((a,b)=>{
     const aTeam = a.team.split(":")[0].trim();
     const bTeam = b.team.split(":")[0].trim();
     return teamOrder.indexOf(aTeam) - teamOrder.indexOf(bTeam);
   });
   renderProjects(projects);
 } catch (err) {
   console.error("JSON load error:", err);
 }
}
function renderProjects(projects) {
 projects.forEach((p, i) => {
   const teamKey = p.team.split(":")[0].trim();
   const container = document.getElementById(`team-${teamKey}`);
   if (!container) return;
   const div = document.createElement("div");
   div.className = "project";
   div.innerHTML = `
<div class="project-info">
<h3>${p.name}</h3>
<p><b>Project Manager:</b> ${p.manager}</p>
<p><b>Project Secretary:</b> ${p.secretary}</p>
<p><b>Deadline:</b> ${p.deadlineText}</p>
<p class="countdown" id="cd${i}"></p>
<p><b>Tentative Possession:</b> ${p.possession}</p>
<p><b>Tentative Completion:</b> ${p.completion}</p>
</div>
<div class="calendar" id="cal${i}"></div>
   `;
   container.appendChild(div);
   createCountdown(p.deadlineText, `cd${i}`);
   createCalendar(p.possession, p.completion, `cal${i}`);
 });
}
function createCountdown(dltxt, id) {
 const target = new Date(dltxt.replace(" ", "T"));
 function tick() {
   const el = document.getElementById(id);
   const now = new Date();
   const diff = target - now;
   if (diff <= 0) {
     el.textContent = "ðŸŽ‰ Completed!";
     return;
   }
   const d = Math.floor(diff / (1000*60*60*24));
   const h = Math.floor((diff / (1000*60*60)) % 24);
   const m = Math.floor((diff / (1000*60)) % 60);
   const s = Math.floor((diff / 1000) % 60);
   el.textContent = `${d} Days ${h} Hours ${m} Minutes ${s} Seconds`;
 }
 tick();
 setInterval(tick, 1000);
}
function createCalendar(posTxt, compTxt, id) {
 const el = document.getElementById(id);
 const now = new Date();
 let startMonth = now.getMonth();
 let startYear = now.getFullYear();
 let possession = posTxt ? new Date(posTxt.replace(" ", "T")) : null;
 let completion = compTxt ? new Date(compTxt.replace(" ", "T")) : null;
 for (let i=0; i<12; i++) {
   let month = (startMonth + i) % 12;
   let year = startYear + Math.floor((startMonth + i)/12);
   let monthStr = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][month] + " " + year;
   let div = document.createElement("div");
   div.className = "month";
   if (possession && completion) {
     let firstOfMonth = new Date(year, month, 1);
     let lastOfMonth = new Date(year, month+1, 0);
     if (firstOfMonth <= completion && lastOfMonth >= possession) {
       div.classList.add("highlight");
     }
   }
   div.textContent = monthStr;
   el.appendChild(div);
 }
}
loadProjects();
</script>
</body>
</html>